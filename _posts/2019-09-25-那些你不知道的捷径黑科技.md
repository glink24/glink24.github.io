---
layout:     post
title:      那些你不知道的捷径黑科技
subtitle:   
date:       2019-09-25
author:     GLink25
header-img:  img/post-那些你不知道的捷径黑科技.jpg
catalog: true
tags:
    - iOS
---
# 那些你不知道的捷径黑科技
workflow自诞生以来就一直是iOS平台上最为强大的效率工具之一，尤其是在被苹果纳入麾下改名快捷指令（以下统称捷径）之后，它的能力更是提升了一个大台阶。不过即使已经成为了官方应用，受限于iOS平台的系统限制和本身的不完善，它还是存在着许许多多的缺陷。但是，在万能的开发者们面前，这样一个免费又强大的工具总能被玩出花来，除了必不可少的URL Scheme和万能的api大法外，捷径上也诞生了各种各样的“骚操作”来弥补它本身功能的不足，其中的部分黑科技简直令人不由得拍手叫好，硬生生在封闭有限的iOS生态中强行破局完成了一系列让人叹为观止的操作。

## 捷径中的控制流
众所周知，捷径本身的循环语句只支持固定次数的循环，相对于各种语言中基础的循环语句而言，捷径缺少了无限循环语句和循环退出语句，这就导致用传统程序员思维编写捷径规则时很伤脑筋。
但自从捷径在workflow时代加入了运行其他workflow的功能后，这就不再是一个棘手的问题了。这个功能的加入让捷径有了完全不一样的编写方式，也让捷径变得更接近传统的函数式编程语言。于是，在捷径中如果想要根据条件提前终止循环，可以将循环编写在一个捷径规则中，然后在另一个规则中调用。函数式的编程有效地减少了编写捷径的工作量，将捷径的运行方式提升到了另一个维度，甚至还能够让捷径完成递归调用以实现无限循环（已被捷径官方认可），堪称捷径的第一次工业革命。
![无限循环](https://i.loli.net/2019/09/25/VAdnPTQmJaEK2Nb.jpg)

## 在捷径中原生运行JavaScript
在见识到这个黑科技之前，我所知的捷径运行JavaScript的方式只有两种，一种是在Safari中运行JavaScript，这种方式只支持在Safari应用内运行js，并且无法传递运行结果给捷径，另一种是借助于Jsbox等第三方应用，但并不是所有人都会为了这一个功能去购买一个app，以这种方式做出来的规则适配性太差。
直到快速查看这个功能被开发出来，这个神乎其技的预览功能除了能查看各种连iOS自己都不能查看的文件以外，竟然还支持预览HTML文件，并且支持在HTML文件中运行JavaScript！第一次见到这个操作的我简直惊为天人，这个功能的横空出世让许多本可以用简单脚本实现的功能却不得已只能借助api大法的捷径们硬生生走出了另一条道路。
例如，出于未知的原因，捷径没有给出本地识别图片中的二维码中的功能（可是你明明就有用相机扫描二维码的功能啊），所以多数扫码捷径实现该功能的方式都靠上传图片云端扫描来实现，这种方式依赖网络而且有泄漏隐私的风险。而在[@吴征](https://sharecuts.cn/user/D8lq1QplMd)的[本地识别二维码捷径](https://sharecuts.cn/shortcut/2575)中，他使用了qrcode.js来识别二维码，而实现的方式则是通过快速查看来运行JavaScript，完美实现本地化扫描相册二维码功能。
![本地二维码识别](https://i.loli.net/2019/09/25/rnYThKL85Jwsp7f.jpg)

另外，这也让一些简单的网页小游戏本地化成为了可能，例如这个[2048小游戏](https://www.icloud.com/shortcuts/35a37d945b1b4704a859ab51db71ece5)捷径，就剑走偏锋地使用base64编码的网页文件完成了所有功能。
同样的，捷径功能“使用safari显示网页”也可以实现相似的功能，两个功能有一些微小的差异，使用时可以都试一下查看哪种效果最好。
![2048](https://i.loli.net/2019/09/25/LvlFu29QcbKXiI7.jpg)

## 更多个性化界面
捷径的一大特色是支持在运行中显示部分界面让用户选择或填写来控制捷径的运行，但是捷径自带的选项列表只支持文本显示，以至于许多开发者在制作列表时不得已用emoji来代替图标，不过，在[@IT Man](https://sharecuts.cn/user/vklrN62lyB)制作的捷径[Vcard演示](https://www.icloud.com/shortcuts/58a210b030db467dbff6647cfdc178a7)中，他使用了vCard的形式来制作列表，这也使得更加用户友好的可视化界面成为了可能。
![vcard列表](https://i.loli.net/2019/09/25/9TVkMd5NZ7CcAop.jpg)

不过对于需要用户选择多个选项的捷径来说，这样的选择列表还远远不够，于是通过多选文件来实现多选选项的捷径也被成功开发出来，在[图片水印](https://www.icloud.com/shortcuts/da74eb56be2f425fb56af54cde456522)这个捷径中，颜色的选取被可视化到了4x4的网格列表中，不仅更利于用户选择，同时也可以实现多选功能，又为捷径增添了几分易用性。
![网格选取](https://i.loli.net/2019/09/25/E5XofHIJ3NWFMAC.jpg)

## 代码式编程
在把捷径使劲往代码语言的路上推的事情上，开发者们可谓是不遗余力。他们已经完成了函数式的编程语言，还顺手开发出了捷径的本地化存储功能。通过捷径自带的文件写入与读取功能，捷径不仅能存储用户的自有配置信息，还能将这些信息与其他捷径共享使用，增加了捷径规则之间的联动性，也让捷径真正具备了编程语言的各项基本特性。
而就在捷径被开发者们“拖离”自己简单易上手的可视化编程的初衷的时候，彻底把捷径变成代码的工具出现了，[splash](https://itunes.apple.com/app/id1455793030)已经支持通过编写代码的形式直接生成shortcuts文件，妈妈再也不用担心我点屏幕点得手指发麻了。除了splash，github上还出现了各式各样用各种方式来编写捷径的项目，例如用文字写捷径的[ScPL](https://docs.scpl.dev/)、用python写捷径的[WIP](https://github.com/alexander-akhmetov/python-shortcuts)、用JS写捷径的[Shortcuts JS](https://github.com/joshfarrant/shortcuts-js)等等，堪称编译原理大佬们的狂欢。
![ScPL](https://i.loli.net/2019/09/25/kVxOgqJDRwspTzA.jpg)

## 总结
不管被收购与否，捷径都一直是iOS效率应用中的典范，无论是设计还是功能它都完成得相当漂亮，也成为了iOS开发者和使用者的心头好。但即使是在被收购之后，捷径依旧有许多做不到的功能，无论是花里胡哨的黑科技也好，苹果的官方开小灶加成也罢，封闭的iOS生态环境依旧让捷径只能带着脚铐跳舞。寥寥可数的应用适配，迟迟不肯加入最后还遮遮掩掩的自动化，完全不存在的后台运行功能，无论神通广大的开发者们怎么想办法，这些没有办法实现的功能就是没有办法。在官方的枷锁下，这些神奇的操作不过是不得已而为之。在效率和安全的抉择中，小心翼翼的苹果哪怕只是开放一个功能也要犹犹豫豫。
这样的决定对于一个亿万级用户体量的公司来说无可厚非，不只是苹果，越来越多的平台选择了封闭，我们看到一个又一个的平台选择在自己的生态中屏蔽他人，为了安全也好，为了牟利也罢，这些都不是用户所能决定的事情。但对于用户而言，适当的开放所表现出的创造力，已经在当前的捷径应用中体现得淋漓尽致。在这样一个人人都能成为开发者的年代，更多的接口意味着更多的可能，Android和Windows的开放造就了它们繁荣的生态，iOS的封闭也造就了它无与伦比的安全性和舒适性，开放与封闭的较量，是每一个工具，无论操作系统也好，app也罢，都应该值得深思的决定。

## 补充技巧
捷径在存储文件时是可以自定义文件后缀名的，通过对变量“设定项目名称”然后存储变量为文件来完成，也可以用此方法来修改文件后缀名：

在iOS13之前，捷径的定时运行除了通过提醒事项来完成，还可以通过设置闹钟的铃声为“hey Siri，运行某个捷径”来完成。

更名捷径后workflow去除了与ifttt的联动，但可以通过webhook来间接联动，具体方法参见这篇文章[这篇文章](https://www.macstories.net/ios/how-to-trigger-ifttt-applets-with-ios-12s-new-shortcuts-app-and-siri/)。


